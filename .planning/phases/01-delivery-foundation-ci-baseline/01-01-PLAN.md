---
phase: 01-delivery-foundation-ci-baseline
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - Makefile
  - scripts/ci_check.sh
  - scripts/verify_repo_structure.py
  - tests/test_phase1_foundation.py
autonomous: true
user_setup: []
must_haves:
  truths:
    - Core developer and CI checks run through script-first entrypoints.
    - Repository structure and ownership boundaries are machine-verifiable.
    - Local verification reproduces CI pass/fail behavior.
  artifacts:
    - Makefile
    - scripts/ci_check.sh
    - scripts/verify_repo_structure.py
    - tests/test_phase1_foundation.py
  key_links:
    - Makefile targets call scripts/ci_check.sh instead of duplicating CI command logic.
    - tests/test_phase1_foundation.py validates verify_repo_structure.py and ci_check.sh behavior.
---

<objective>
Establish a script-first execution contract for development and CI parity checks.

Purpose: Make core quality checks discoverable, repeatable, and enforceable from deterministic entrypoints.
Output: Standardized make targets, shared CI check script, structure verifier, and focused tests.
</objective>

<execution_context>
@/Users/dustinober/.codex/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-delivery-foundation-ci-baseline/01-RESEARCH.md
@Makefile
@tests/test_smoke.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add canonical CI parity command surface</name>
  <files>Makefile, scripts/ci_check.sh</files>
  <action>Create `scripts/ci_check.sh` as the single source of truth for phase-1 checks (`black --check`, `pytest -q`, and any lightweight sanity command needed). Update `Makefile` to expose this through stable script-first targets (for example `ci-check`) and avoid duplicating check commands in multiple targets.</action>
  <verify>`bash scripts/ci_check.sh` returns exit 0 on clean state and non-zero on induced failure; `make ci-check` executes the same script path.</verify>
  <done>A contributor can run one documented command locally and get the same core checks CI will run.</done>
</task>

<task type="auto">
  <name>Task 2: Add repository structure guard for script-first boundaries</name>
  <files>scripts/verify_repo_structure.py, tests/test_phase1_foundation.py</files>
  <action>Create `scripts/verify_repo_structure.py` to enforce a minimal contract for script-first ownership (for example: required top-level dirs exist, `scripts/` and `src/` are present, required CI workflow file exists, and no forbidden generated artifacts are committed). Add focused tests in `tests/test_phase1_foundation.py` that exercise success and failure modes using temp fixtures or monkeypatching.</action>
  <verify>`pytest -q tests/test_phase1_foundation.py` passes and includes at least one negative assertion for structure violations.</verify>
  <done>Repository boundary checks are automated and fail fast when structure drifts away from script-first conventions.</done>
</task>

<task type="auto">
  <name>Task 3: Wire structure verification into local quality flow</name>
  <files>scripts/ci_check.sh, Makefile</files>
  <action>Update `scripts/ci_check.sh` to invoke `python scripts/verify_repo_structure.py` before test/lint execution so local and CI runs both include structure validation as a blocking check.</action>
  <verify>`bash scripts/ci_check.sh` prints structure-validation step and fails if verifier exits non-zero.</verify>
  <done>Structure checks are part of the default quality path, not an optional manual command.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python scripts/verify_repo_structure.py`
- [ ] `pytest -q tests/test_phase1_foundation.py`
- [ ] `bash scripts/ci_check.sh`
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Script-first command surface is canonical and test-backed
</success_criteria>

<output>
After completion, create `.planning/phases/01-delivery-foundation-ci-baseline/01-01-SUMMARY.md`
</output>
