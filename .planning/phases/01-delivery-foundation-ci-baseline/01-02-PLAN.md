---
phase: 01-delivery-foundation-ci-baseline
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/ci.yml
  - .pre-commit-config.yaml
  - docs/ci_baseline.md
autonomous: true
user_setup: []
must_haves:
  truths:
    - CI runs automatically on push and pull request with explicit pass/fail outcomes.
    - CI and local guardrails use the same baseline check sequence.
    - CI policy and expected checks are documented for contributors.
  artifacts:
    - .github/workflows/ci.yml
    - .pre-commit-config.yaml
    - docs/ci_baseline.md
  key_links:
    - ci.yml executes the same check entrypoint defined in plan 01 (`scripts/ci_check.sh`) once available.
    - pre-commit hooks reflect a subset of CI checks so contributors catch issues pre-push.
---

<objective>
Harden the CI baseline so Phase 1 requirement `QUAL-03` is enforced consistently.

Purpose: Turn existing lightweight CI into explicit, maintainable policy with clear local parity.
Output: Updated workflow, aligned pre-commit hooks, and CI policy documentation.
</objective>

<execution_context>
@/Users/dustinober/.codex/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-delivery-foundation-ci-baseline/01-RESEARCH.md
@.github/workflows/ci.yml
@.pre-commit-config.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Normalize CI workflow around explicit baseline checks</name>
  <files>.github/workflows/ci.yml</files>
  <action>Refactor CI to keep push/PR triggers explicit, ensure deterministic Python setup, and run baseline checks in an ordered sequence with clear step names. Prefer invoking the canonical script-first entrypoint (from plan 01) rather than duplicating command logic in workflow YAML.</action>
  <verify>Run CI workflow locally via dry validation where possible (for example `act` if available) or validate YAML integrity and command references with `rg`/`yq` checks; workflow file contains push and pull_request triggers plus explicit check steps.</verify>
  <done>The workflow is readable, deterministic, and clearly enforces pass/fail gates on every push and pull request.</done>
</task>

<task type="auto">
  <name>Task 2: Align pre-commit hooks to CI baseline</name>
  <files>.pre-commit-config.yaml</files>
  <action>Update pre-commit configuration so local hooks catch the most common CI failures early (formatting and basic sanity checks). Keep hooks fast and avoid heavy tasks that would make commit flow unusable.</action>
  <verify>`pre-commit run --all-files` passes (or documents expected local dependency prerequisite) and includes the intended hooks.</verify>
  <done>Contributors get quick feedback locally that meaningfully reduces avoidable CI failures.</done>
</task>

<task type="auto">
  <name>Task 3: Document CI contract and failure interpretation</name>
  <files>docs/ci_baseline.md</files>
  <action>Create CI baseline documentation describing triggers, required checks, and how to reproduce/fix each failure class locally using the same script-first command surface.</action>
  <verify>Open doc and confirm it references actual workflow/check commands and maps each step to local remediation commands.</verify>
  <done>CI policy is explicit and self-serve for contributors without ad-hoc tribal knowledge.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -m compileall scripts tests`
- [ ] `pre-commit run --all-files`
- [ ] Confirm `.github/workflows/ci.yml` has both `push` and `pull_request` triggers
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- CI policy is explicit and locally reproducible
</success_criteria>

<output>
After completion, create `.planning/phases/01-delivery-foundation-ci-baseline/01-02-SUMMARY.md`
</output>
