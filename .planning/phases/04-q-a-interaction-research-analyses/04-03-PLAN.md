---
phase: 04-q-a-interaction-research-analyses
plan: "03"
type: execute
wave: 2
depends_on:
  - "01"
files_modified:
  - src/analysis/topic_modeling.py
  - scripts/analyze_topics.py
  - tests/test_topic_modeling_analysis.py
  - docs/analysis_workflow.md
autonomous: true
user_setup: []
must_haves:
  truths:
    - Topic modeling analysis is reproducible with fixed seeds and deterministic preprocessing.
    - Topic outputs include top terms, per-label topic prevalence, and hypothesis-oriented interpretation summaries.
    - Topic artifacts are persisted in phase-4 output paths and indexed for report ingestion.
  artifacts:
    - src/analysis/topic_modeling.py
    - scripts/analyze_topics.py
    - tests/test_topic_modeling_analysis.py
    - artifacts/analysis/phase4/topic_modeling/*
  key_links:
    - scripts/analyze_topics.py calls src/analysis/topic_modeling.py with fixed random-state and vectorizer parameters.
    - topic outputs include model config metadata, top-term tables, and label-level prevalence comparisons.
    - docs/analysis_workflow.md records reproducibility controls and execution commands.
---

<objective>
Implement reproducible topic-modeling analyses linked to evasion hypotheses.

Purpose: Satisfy `ANLY-06` topic-analysis requirements with stable model outputs and interpretation-ready artifacts.
Output: Topic modeling module + CLI script + tests generating tables/charts and hypothesis summaries.
</objective>

<execution_context>
@/Users/dustinober/.codex/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-q-a-interaction-research-analyses/04-RESEARCH.md
@.planning/phases/04-q-a-interaction-research-analyses/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build deterministic topic modeling pipeline with persisted config metadata</name>
  <files>src/analysis/topic_modeling.py, scripts/analyze_topics.py</files>
  <action>Implement vectorization and topic decomposition workflow with explicit random seeds and configurable topic count. Persist topic-term weights, document-topic distributions, and serialized model settings for reproducibility.</action>
  <verify>`python scripts/analyze_topics.py --input data/processed/evasionbench_prepared.parquet --output-root artifacts/analysis/phase4 --topics 8 --seed 42` writes stable topic tables and config metadata.</verify>
  <done>Topic modeling outputs are reproducible and traceable to explicit modeling configuration.</done>
</task>

<task type="auto">
  <name>Task 2: Add label-stratified topic prevalence analyses and visual summaries</name>
  <files>src/analysis/topic_modeling.py, scripts/analyze_topics.py</files>
  <action>Compute topic prevalence by evasiveness label, generate publication-style comparative charts, and export concise interpretation notes connecting topic differences to evasion behavior hypotheses.</action>
  <verify>`python scripts/analyze_topics.py --input data/processed/evasionbench_prepared.parquet --output-root artifacts/analysis/phase4 --emit-summary` emits prevalence charts and hypothesis summary artifacts.</verify>
  <done>Topic analysis findings are directly usable in report sections without manual notebook interpretation.</done>
</task>

<task type="auto">
  <name>Task 3: Add topic-analysis tests for deterministic outputs and schema guarantees</name>
  <files>tests/test_topic_modeling_analysis.py</files>
  <action>Create tests for required output schemas, deterministic top-term ordering on fixtures, and graceful handling of sparse/short text segments. Include at least one negative test for missing input fields.</action>
  <verify>`pytest -q tests/test_topic_modeling_analysis.py` passes and validates deterministic reproducibility guarantees.</verify>
  <done>Topic-modeling pipeline is test-backed and robust for automation.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python scripts/analyze_topics.py --input data/processed/evasionbench_prepared.parquet --output-root artifacts/analysis/phase4 --topics 8 --seed 42`
- [ ] `pytest -q tests/test_topic_modeling_analysis.py`
- [ ] `python -m json.tool artifacts/analysis/phase4/topic_modeling/topic_summary.json >/dev/null`
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Topic-modeling outputs are deterministic and hypothesis-linked
</success_criteria>

<output>
After completion, create `.planning/phases/04-q-a-interaction-research-analyses/04-03-SUMMARY.md`
</output>
