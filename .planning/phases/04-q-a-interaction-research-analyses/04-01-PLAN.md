---
phase: 04-q-a-interaction-research-analyses
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/analysis/artifacts.py
  - scripts/run_phase4_analyses.py
  - dvc.yaml
  - docs/analysis_workflow.md
  - tests/test_phase4_artifact_contract.py
autonomous: true
user_setup: []
must_haves:
  truths:
    - Phase 4 analyses execute through script-first entrypoints with deterministic paths and fixed parameters.
    - Q-A semantic, topic, and question-behavior artifacts are indexed in a stable schema for report consumption.
    - DVC stages capture phase-4 dependencies and outputs for reproducible reruns.
  artifacts:
    - src/analysis/artifacts.py
    - scripts/run_phase4_analyses.py
    - dvc.yaml
    - docs/analysis_workflow.md
    - tests/test_phase4_artifact_contract.py
  key_links:
    - scripts/run_phase4_analyses.py invokes family-specific phase-4 analysis scripts with shared input/output arguments.
    - src/analysis/artifacts.py defines canonical phase-4 output folders and artifact index fields.
    - dvc.yaml wires phase-4 stages to prepared parquet inputs and tracked analysis outputs.
---

<objective>
Create the shared execution and artifact contract for all Phase 4 analyses.

Purpose: Ensure semantic, topic, and question-behavior scripts write consistent, report-ready outputs through reproducible stages.
Output: Phase-level orchestration script, phase-4 artifact index contract updates, DVC stage wiring, and tests/docs for the contract.
</objective>

<execution_context>
@/Users/dustinober/.codex/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-q-a-interaction-research-analyses/04-RESEARCH.md
@src/analysis/artifacts.py
@scripts/run_phase3_analyses.py
@dvc.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend artifact contract for Phase 4 analysis families</name>
  <files>src/analysis/artifacts.py, tests/test_phase4_artifact_contract.py</files>
  <action>Add deterministic artifact-directory and metadata-index helpers for `semantic_similarity`, `topic_modeling`, and `question_behavior` outputs under `artifacts/analysis/phase4`. Include validation for required index keys and hypothesis-summary pointers.</action>
  <verify>`pytest -q tests/test_phase4_artifact_contract.py` passes and validates required phase-4 index fields and paths.</verify>
  <done>All phase-4 analyses can publish outputs through one consistent contract consumable by downstream reporting.</done>
</task>

<task type="auto">
  <name>Task 2: Add phase-level orchestration command and Makefile target</name>
  <files>scripts/run_phase4_analyses.py, Makefile</files>
  <action>Implement a script entrypoint that runs all phase-4 analysis families with explicit CLI flags (`--input`, `--output-root`, `--families`). Add a corresponding Make target (for example `analysis-phase4`) and ensure no notebook dependencies.</action>
  <verify>`python scripts/run_phase4_analyses.py --input data/processed/evasionbench_prepared.parquet --output-root artifacts/analysis/phase4 --families all` completes successfully.</verify>
  <done>Contributors can run full phase-4 analysis generation with one canonical script command.</done>
</task>

<task type="auto">
  <name>Task 3: Wire reproducible DVC stage graph and documentation updates</name>
  <files>dvc.yaml, docs/analysis_workflow.md</files>
  <action>Add DVC stages for each phase-4 family script plus a meta stage for full phase execution. Document command usage, required inputs, generated outputs, and troubleshooting notes for deterministic reruns.</action>
  <verify>`dvc repro` includes phase-4 stages and `rg -n "phase4|analysis-phase4|run_phase4_analyses" docs/analysis_workflow.md` confirms doc alignment.</verify>
  <done>Phase-4 analyses are reproducible and operationally documented for local and CI execution.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pytest -q tests/test_phase4_artifact_contract.py`
- [ ] `python scripts/run_phase4_analyses.py --input data/processed/evasionbench_prepared.parquet --output-root artifacts/analysis/phase4 --families all`
- [ ] `dvc repro`
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Phase-4 contract and orchestration are reproducible and report-ready
</success_criteria>

<output>
After completion, create `.planning/phases/04-q-a-interaction-research-analyses/04-01-SUMMARY.md`
</output>
