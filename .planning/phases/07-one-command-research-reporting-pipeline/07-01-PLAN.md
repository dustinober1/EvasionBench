---
phase: 07-one-command-research-reporting-pipeline
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/reporting.py
  - scripts/build_report_manifest.py
  - docs/analysis_workflow.md
  - tests/test_report_manifest_contract.py
autonomous: true
user_setup: []
must_haves:
  truths:
    - Report generation uses a deterministic manifest that enumerates required source artifacts before rendering.
    - Manifest entries for figures/tables include reproducibility provenance (source stage/script/path).
    - Missing required artifacts fail early with actionable diagnostics.
  artifacts:
    - src/reporting.py
    - scripts/build_report_manifest.py
    - tests/test_report_manifest_contract.py
    - artifacts/reports/phase7/provenance_manifest.json
  key_links:
    - scripts/build_report_manifest.py gathers phase3/phase4/phase5/phase6 outputs into one normalized context payload.
    - src/reporting.py defines schema validators and provenance helpers reused by downstream report rendering.
    - tests/test_report_manifest_contract.py enforces required fields and missing-artifact failure behavior.
---

<objective>
Define and enforce the report artifact/provenance contract for Phase 7.

Purpose: make report generation deterministic and traceable before orchestration/rendering work begins.
Output: normalized manifest builder, provenance schema, and contract tests.
</objective>

<execution_context>
@/home/dusitnober/.codex/get-shit-done/workflows/execute-plan.md
@/home/dusitnober/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-one-command-research-reporting-pipeline/07-RESEARCH.md
@src/analysis/artifacts.py
@scripts/run_phase3_analyses.py
@scripts/run_phase4_analyses.py
@scripts/run_classical_baselines.py
@scripts/run_transformer_baselines.py
@docs/analysis_workflow.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement report manifest schema and provenance helpers</name>
  <files>src/reporting.py</files>
  <action>Create helpers for building and validating a normalized report build context with required sections (dataset, analyses, models, explainability, diagnostics) and provenance fields (`stage`, `script`, `artifact_path`, `generated_at`). Add strict validators that raise descriptive errors when required keys are missing.</action>
  <verify>`pytest -q tests/test_report_manifest_contract.py -k "schema"` validates required section and provenance keys.</verify>
  <done>Report data model is stable and machine-validated for downstream rendering.</done>
</task>

<task type="auto">
  <name>Task 2: Add script-first manifest builder entrypoint</name>
  <files>scripts/build_report_manifest.py</files>
  <action>Create CLI script that scans canonical artifact roots (`artifacts/analysis/phase3`, `artifacts/analysis/phase4`, `artifacts/models/phase5`, `artifacts/models/phase6`, `artifacts/explainability/phase6`, `artifacts/diagnostics/phase6`) and writes `artifacts/reports/phase7/provenance_manifest.json`. Fail with non-zero status and clear missing-path list when prerequisites are absent.</action>
  <verify>`python scripts/build_report_manifest.py --output artifacts/reports/phase7/provenance_manifest.json` writes manifest or exits non-zero with actionable missing-artifact message.</verify>
  <done>One command can produce validated report input metadata with traceability.</done>
</task>

<task type="auto">
  <name>Task 3: Add manifest contract tests and documentation updates</name>
  <files>tests/test_report_manifest_contract.py, docs/analysis_workflow.md</files>
  <action>Add tests for required keys, deterministic ordering, and missing-artifact failures. Update docs with manifest location, schema summary, and how downstream scripts consume it.</action>
  <verify>`pytest -q tests/test_report_manifest_contract.py` passes all contract checks.</verify>
  <done>Manifest contract is test-backed and documented for report pipeline users.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python scripts/build_report_manifest.py --output artifacts/reports/phase7/provenance_manifest.json`
- [ ] `pytest -q tests/test_report_manifest_contract.py`
- [ ] `rg -n "provenance_manifest|phase7" docs/analysis_workflow.md`
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Report manifest includes reproducibility provenance for figures/tables
- Missing prerequisites fail with actionable errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-one-command-research-reporting-pipeline/07-01-SUMMARY.md`
</output>
