---
phase: 07-one-command-research-reporting-pipeline
plan: "04"
type: execute
wave: 3
depends_on:
  - "03"
files_modified:
  - scripts/render_research_report.py
  - scripts/run_research_pipeline.py
  - docs/reporting_pipeline.md
  - tests/test_report_render_outputs.py
  - requirements.txt
autonomous: true
user_setup: []
must_haves:
  truths:
    - HTML and PDF are generated from the same Markdown source artifact.
    - Render outputs preserve stable formatting and reproducibility metadata.
    - Final report artifacts include explicit source-stage traceability for all figures/tables.
  artifacts:
    - scripts/render_research_report.py
    - artifacts/reports/phase7/report.html
    - artifacts/reports/phase7/report.pdf
    - artifacts/reports/phase7/report_traceability.json
    - tests/test_report_render_outputs.py
  key_links:
    - render_research_report.py converts one Markdown source into HTML and PDF outputs.
    - run_research_pipeline.py invokes renderer as final stage.
    - report_traceability.json links each figure/table id to provenance manifest entries.
---

<objective>
Render HTML/PDF from canonical Markdown and finalize traceability guarantees.

Purpose: satisfy `RPT-03` and `RPT-04` with one-source multi-format outputs plus auditable figure/table lineage.
Output: render script, traceability output, tests, and user-facing docs.
</objective>

<execution_context>
@/home/dusitnober/.codex/get-shit-done/workflows/execute-plan.md
@/home/dusitnober/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-one-command-research-reporting-pipeline/07-RESEARCH.md
@.planning/phases/07-one-command-research-reporting-pipeline/07-03-SUMMARY.md
@scripts/generate_research_report.py
@scripts/run_research_pipeline.py
@templates/research_report.md.j2
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement HTML/PDF rendering pipeline from one Markdown source</name>
  <files>scripts/render_research_report.py, requirements.txt</files>
  <action>Add renderer that reads `report.md`, generates `report.html` (Markdown parser + template CSS), then generates `report.pdf` from the same HTML via WeasyPrint. Add required dependencies and fail with actionable setup guidance if rendering dependencies are unavailable.</action>
  <verify>`python scripts/render_research_report.py --input artifacts/reports/phase7/report.md --output-root artifacts/reports/phase7` creates both HTML and PDF outputs.</verify>
  <done>Multi-format report outputs are reproducibly generated from one source.</done>
</task>

<task type="auto">
  <name>Task 2: Emit figure/table traceability output and pipeline integration</name>
  <files>scripts/render_research_report.py, scripts/run_research_pipeline.py</files>
  <action>Generate `report_traceability.json` mapping each figure/table anchor in report outputs to provenance manifest entries (`stage`, `script`, `artifact_path`). Ensure orchestration script runs renderer as final stage and includes traceability file in run summary.</action>
  <verify>`python scripts/run_research_pipeline.py --output-root artifacts/reports/phase7 --from-stage report_render` writes report outputs plus traceability map.</verify>
  <done>Every report visual/table is auditable back to reproducible source artifacts.</done>
</task>

<task type="auto">
  <name>Task 3: Add render/traceability tests and usage docs</name>
  <files>tests/test_report_render_outputs.py, docs/reporting_pipeline.md</files>
  <action>Add tests for existence/size checks (`report.md`, `report.html`, `report.pdf`), stable metadata block in all formats, and complete traceability mappings for all declared figure/table ids. Document canonical commands, expected outputs, and troubleshooting for renderer dependencies.</action>
  <verify>`pytest -q tests/test_report_render_outputs.py` validates output contract and traceability completeness.</verify>
  <done>Report rendering and lineage guarantees are tested and operationally documented.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python scripts/render_research_report.py --input artifacts/reports/phase7/report.md --output-root artifacts/reports/phase7`
- [ ] `pytest -q tests/test_report_render_outputs.py`
- [ ] `python scripts/run_research_pipeline.py --output-root artifacts/reports/phase7`
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- HTML and PDF derive from one canonical Markdown source
- Traceability mapping covers every figure/table in final report
</success_criteria>

<output>
After completion, create `.planning/phases/07-one-command-research-reporting-pipeline/07-04-SUMMARY.md`
</output>
