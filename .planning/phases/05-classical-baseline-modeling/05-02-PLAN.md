---
phase: 05-classical-baseline-modeling
plan: "02"
type: execute
wave: 2
depends_on:
  - "01"
files_modified:
  - src/models.py
  - scripts/run_experiment.py
  - scripts/run_classical_baselines.py
  - tests/test_classical_logreg_baseline.py
autonomous: true
user_setup: []
must_haves:
  truths:
    - TF-IDF + Logistic Regression baseline trains and evaluates from scripts with deterministic split/seed controls.
    - Per-class metrics and confusion matrix artifacts are emitted for every logistic run.
    - Logistic run metadata is logged in MLflow and mirrored in local artifact outputs.
  artifacts:
    - src/models.py
    - scripts/run_experiment.py
    - tests/test_classical_logreg_baseline.py
    - artifacts/models/phase5/logreg/*
  key_links:
    - scripts/run_experiment.py uses shared evaluation contract to write per-class report and confusion matrix.
    - src/models.py logistic trainer supports explicit feature and regularization settings persisted to metadata.
    - tests assert logistic outputs are complete and deterministic for fixture inputs.
---

<objective>
Harden and complete the TF-IDF + Logistic Regression baseline for Phase 5.

Purpose: satisfy `MODL-01` and Phase 5 metric-contract expectations with script-first reproducibility.
Output: robust logistic baseline pipeline, complete metrics artifacts, and test coverage.
</objective>

<execution_context>
@/Users/dustinober/.codex/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-classical-baseline-modeling/05-RESEARCH.md
@.planning/phases/05-classical-baseline-modeling/05-01-SUMMARY.md
@scripts/run_experiment.py
@src/models.py
@src/evaluation.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Finalize deterministic TF-IDF + Logistic Regression training configuration</name>
  <files>src/models.py, scripts/run_experiment.py</files>
  <action>Expose explicit vectorizer and classifier params (ngram range, min_df, C, class-weight strategy, solver) and persist these settings to run metadata. Keep split strategy fixed by seed and documented.</action>
  <verify>`python scripts/run_experiment.py --data data/processed/evasionbench_prepared.parquet --run-name tfidf-logreg-phase5 --random-state 42` logs deterministic params/metrics to MLflow.</verify>
  <done>Logistic baseline is fully parameterized, reproducible, and traceable.</done>
</task>

<task type="auto">
  <name>Task 2: Ensure per-class and confusion outputs are generated for every logistic run</name>
  <files>scripts/run_experiment.py, src/evaluation.py</files>
  <action>Guarantee that logistic runs always emit classification report and confusion matrix artifacts alongside aggregate metrics and metadata under the phase-5 output root.</action>
  <verify>`python scripts/run_classical_baselines.py --input data/processed/evasionbench_prepared.parquet --output-root artifacts/models/phase5 --families logreg` writes expected artifacts.</verify>
  <done>Phase requirement for per-class outputs is met for logistic family.</done>
</task>

<task type="auto">
  <name>Task 3: Add logistic baseline tests for artifact completeness and determinism</name>
  <files>tests/test_classical_logreg_baseline.py</files>
  <action>Add tests validating artifact files, required schema fields, and deterministic metrics on fixture data. Include at least one negative test for missing target column handling.</action>
  <verify>`pytest -q tests/test_classical_logreg_baseline.py` passes with positive and negative assertions.</verify>
  <done>Logistic baseline behavior is test-backed and automation-safe.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python scripts/run_experiment.py --data data/processed/evasionbench_prepared.parquet --run-name tfidf-logreg-phase5 --random-state 42`
- [ ] `python scripts/run_classical_baselines.py --input data/processed/evasionbench_prepared.parquet --output-root artifacts/models/phase5 --families logreg`
- [ ] `pytest -q tests/test_classical_logreg_baseline.py`
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- `MODL-01` is satisfied with reproducible logistic artifacts
</success_criteria>

<output>
After completion, create `.planning/phases/05-classical-baseline-modeling/05-02-SUMMARY.md`
</output>
